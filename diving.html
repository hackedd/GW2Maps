<!DOCTYPE html>
<html>
  <head>
    <title>Guild Wars 2 Diving Locations</title>

    <link href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.6/leaflet.css" rel="stylesheet" media="screen">

    <style type="text/css">
      body {
        font-family: sans-serif;
        margin: 2em auto;
        width: 960px;
      }
      #map {
        width: 960px;
        height: 900px;
        margin: 1em;
      }
    </style>
  </head>
  <body>
    <h1>Guild Wars 2 Diving Locations</h1>
    <div id="map"></div>

    <script>
    /*<![CDATA[*/
    var require = {
        baseUrl: "src",
        paths: {
            "jquery": "//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery",
            "leaflet": "//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet-src",
        }
    }
    /*]]>*/
    </script>
    <script src="src/require-2.1.14.js"></script>
    <script>
      require(["leaflet", "jquery", "map"], function (L, $, gw2map) {
          var map = gw2map.init("map", "Tyria"),
              titleTemplate = "Diving locaiton in {area}, {map}",
              popupTemplate = ("<h3>Diving location in {area}, {map}</h3>\n" +
                               "<p>{notes}</p>\n" +
                               "<p>\n" +
                               "Closest Waypoint:\n" +
                               "<strong>{waypoint}</strong> {waypoint_link}<br />\n" +
                               "Closest POI:\n" +
                               "</strong>{poi}</strong> {poi_link}<br />" +
                               "</p>\n");

          map.on("load", function () {
              $.get("diving-locations.json", function (data) {
                  $.each(data, function () {
                      var options = {
                              title: L.Util.template(titleTemplate, this),
                              clickable: true
                          },
                          marker = L.marker(map.unproject(this.x, this.y), options),
                          popupText = L.Util.template(popupTemplate, this);

                      marker.addTo(map.map);
                      marker.bindPopup(popupText);
                      marker.on("click", function () { marker.openPopup(); });
                  });
              });
          });
      });
    </script>
  </body>
</html>
